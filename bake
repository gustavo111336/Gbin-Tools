#!/data/data/com.termux/files/usr/bin/bash
# ğŸ¦ Dandelion BAKE - O Validador de FermentaÃ§Ã£o

# Cores para o visual Dandelion
G='\033[0;32m'
R='\033[0;31m'
Y='\033[0;33m'
B='\033[0;34m'
N='\033[0m'

echo -e "${B}ğŸ Dandelion Bake: Iniciando fornada...${N}"
sleep 0.5

# 1. Analisando o Trigo (Arquivos)
echo -ne "${Y}ğŸŒ¾ Analisando o trigo...${N} "
FILES_COUNT=$(ls -1 | wc -l)
echo -e "($FILES_COUNT arquivos encontrados)"

# 2. Adicionando Fermento (PermissÃµes)
echo -e "${Y}ğŸ§ª Adicionando fermento (chmod +x)...${N}"
chmod +x *

# 3. Verificando o Calor do Forno (Hardware via termux-api)
DATA=$(termux-battery-status)
PERC=$(echo "$DATA" | grep '"percentage":' | awk '{print $2}' | tr -d ',')
TEMP=$(echo "$DATA" | grep '"temperature":' | awk '{print $2}' | tr -d ',')
# Remove o decimal da temperatura para o IF nÃ£o quebrar
TEMP_INT=${TEMP%.*}

echo -e "  ğŸ”‹ Carga: ${G}$PERC%${N} | ğŸŒ¡ï¸ Calor: ${G}$TEMPÂ°C${N}"

# 4. VerificaÃ§Ã£o de SeguranÃ§a
if [ -z "$PERC" ]; then
    echo -e "${R}âŒ ERRO: O forno nÃ£o ligou (termux-api falhou).${N}"
    exit 1
fi

if [ "$PERC" -lt 20 ]; then
    echo -e "${R}âš ï¸  MASSA MURCHANDO! Bateria abaixo de 20%. Conecte o carregador.${N}"
elif [ "$TEMP_INT" -gt 42 ]; then
    echo -e "${R}ğŸ”¥ FORNO MUITO QUENTE! $TEMPÂ°C pode queimar os bits.${N}"
else
    echo -e "${G}âœ… FERMENTAÃ‡ÃƒO PERFEITA. O bit assou e o display brilha!${N}"
    echo -e "${B}ğŸš€ Pronto para o deploy.${N}"
fi

